{{> header.hbs}}
<h1>Anamnese</h1>
<div class="col-md-4">
    <form id="edit-anamnese">
        <div class="form-group">
            <label for="medic">Médico:</label>
            <span id="medic" name="medic">{{medic.name}}</span>
        </div>

        <div class="form-group">
            <label for="patient">Paciente:</label>
            <span id="patient" data-id="{{patient.id}}" name="patient">{{patient.name}}</span>
        </div>

        <div class="form-group">
            <label for="date">Date:</label>
            <span id="date" name="date">
                <script>
                    var date = new Date('{{data.date}}');
                    document.write(date.getDate() + '-' + (date.getMonth() + 1) + '-' + date.getFullYear())
                </script>
            </span>
        </div>

        <div class="form-group">
            <label for="drugs">Remédios:</label>
            <textarea id="drugs" name="drugs" data-id="{{data.id}}" class="form-control">{{data.drugs}}</textarea>
        </div>

        <div class="form-group">
            <label for="orders">Pedidos Médicos:</label>
            <textarea id="orders" name="orders" class="form-control">{{data.orders}}</textarea>
        </div>
        <div class="btn-group">
            <input type="submit" class="btn btn-success" value="Editar">
            <a class="btn btn-warning" href="/patients/{{data.patient_id}}">Voltar</a>
        </div>
    </form>
</div>
<script>
    $(function () {
        $("#edit-anamnese").submit(function (event) {
            event.preventDefault();
            var drugs = $('#drugs');
            var formData = {
                orders: $('#orders').val(),
                drugs: drugs.val()
            };
            $.ajax({
                url: "/anamneses/" + drugs.attr('data-id'),
                type: 'PUT',
                contentType: 'application/json',
                data: JSON.stringify(formData),
                dataType: 'json',
                statusCode: {
                    200: function () {
                        document.location = "/patients/" + $('#patient').attr('data-id');
                    }
                }
            });
        });
    });
</script>
{{> footer.hbs}}